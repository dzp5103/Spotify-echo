# Enhanced Security Headers for EchoTune AI
# Comprehensive security configuration for production deployment

# HTTP Strict Transport Security (HSTS)
# Forces HTTPS for 1 year, includes subdomains, allows preloading
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# Content Security Policy (CSP)
# Comprehensive policy for music application with Spotify integration
add_header Content-Security-Policy "default-src 'self'; 
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://accounts.spotify.com https://sdk.scdn.co https://open.spotify.com; 
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://sdk.scdn.co; 
    font-src 'self' https://fonts.gstatic.com https://sdk.scdn.co; 
    img-src 'self' data: https: blob: https://i.scdn.co https://mosaic.scdn.co https://lineup-images.scdn.co; 
    connect-src 'self' https://api.spotify.com https://accounts.spotify.com wss: ws: https://apresolve.spotify.com; 
    media-src 'self' https: blob: https://p.scdn.co; 
    object-src 'none'; 
    base-uri 'self'; 
    form-action 'self' https://accounts.spotify.com; 
    frame-ancestors 'none'; 
    upgrade-insecure-requests;" always;

# X-Frame-Options - Prevent clickjacking
add_header X-Frame-Options "DENY" always;

# X-Content-Type-Options - Prevent MIME type sniffing
add_header X-Content-Type-Options "nosniff" always;

# X-XSS-Protection - Enable XSS filtering
add_header X-XSS-Protection "1; mode=block" always;

# Referrer Policy - Control referrer information
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Permissions Policy - Control browser features
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), usb=(), serial=(), payment=(), magnetometer=(), gyroscope=(), accelerometer=()" always;

# Cross-Origin Policies
add_header Cross-Origin-Embedder-Policy "require-corp" always;
add_header Cross-Origin-Opener-Policy "same-origin" always;
add_header Cross-Origin-Resource-Policy "same-origin" always;

# Server Information Hiding
server_tokens off;
add_header X-Robots-Tag "noindex, nofollow" always;

# Cache Control for Security
add_header Cache-Control "no-cache, no-store, must-revalidate" always;
add_header Pragma "no-cache" always;
add_header Expires "0" always;

# Custom Security Headers
add_header X-Powered-By "EchoTune AI" always;
add_header X-Content-Duration "30" always;