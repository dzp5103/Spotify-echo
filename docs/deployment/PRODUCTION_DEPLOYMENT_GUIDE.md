# üöÄ EchoTune AI - Production Deployment Guide

## Production Readiness Status: ‚úÖ READY

**Last Validated:** August 2025  
**Readiness Score:** 16/16 Passed, 3 Warnings, 0 Critical Issues

---

## üéØ Quick Production Deployment

### Prerequisites
- Ubuntu 22.04+ server (DigitalOcean droplet recommended)
- Domain name (optional but recommended for HTTPS)
- Spotify Developer Account credentials

### One-Command Deployment
```bash
# 1. SSH into your server
ssh root@your-server-ip

# 2. Clone repository and install doctl with GH_PAT
git clone https://github.com/dzp5103/Spotify-echo.git
cd Spotify-echo
# Set GitHub PAT for authentication (if available)
export GH_PAT=your_github_pat_token
# Auto-install doctl with GH_PAT integration
./scripts/install-doctl-ghpat.sh

# 3. Run automated deployment
curl -fsSL https://raw.githubusercontent.com/dzp5103/Spotify-echo/main/scripts/deploy-digitalocean.sh | bash

# 4. Configure credentials (REQUIRED)
cd /opt/echotune
nano .env
# Update SPOTIFY_CLIENT_ID and SPOTIFY_CLIENT_SECRET

# 5. Restart services
docker-compose restart
```

---

## üõ†Ô∏è doctl Auto-Installation with GitHub PAT

### Overview
EchoTune AI now includes automated installation of DigitalOcean CLI (doctl) with GitHub Personal Access Token (GH_PAT) integration for seamless CI/CD deployment workflows.

### Quick Installation
```bash
# Basic installation
./scripts/install-doctl-ghpat.sh

# With environment variables
export GH_PAT=ghp_xxxxxxxxxxxxxxxxxxxx
export DO_API_TOKEN=dop_v1_xxxxxxxxxxxxxxxxxxxx
./scripts/install-doctl-ghpat.sh

# In CI/CD pipeline
export GH_PAT=${{ secrets.GH_PAT }}
export DO_API_TOKEN=${{ secrets.DO_API_TOKEN }}
./scripts/install-doctl-ghpat.sh
```

### Features
- **Auto-Detection**: Automatically detects platform (Linux/macOS) and architecture
- **Latest Version**: Downloads and installs the latest doctl version (1.109.0)
- **GH_PAT Integration**: Uses GitHub Personal Access Token for authentication workflows
- **Fallback Options**: Provides multiple installation paths and authentication methods
- **Validation**: Verifies installation and configuration automatically

### Authentication Workflow
1. **GitHub CLI Authentication**: Uses GH_PAT to authenticate GitHub CLI
2. **Token Management**: Securely handles GitHub and DigitalOcean API tokens
3. **doctl Configuration**: Configures doctl authentication with DigitalOcean
4. **Validation**: Verifies all authentication steps

### Environment Variables
```env
# Required for GitHub integration
GH_PAT=ghp_xxxxxxxxxxxxxxxxxxxx

# Required for DigitalOcean operations
DO_API_TOKEN=dop_v1_xxxxxxxxxxxxxxxxxxxx

# Optional - fallback authentication
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxx
```

### Usage in CI/CD
```yaml
# GitHub Actions example
- name: Install doctl with GH_PAT
  env:
    GH_PAT: ${{ secrets.GH_PAT }}
    DO_API_TOKEN: ${{ secrets.DO_API_TOKEN }}
  run: |
    ./scripts/install-doctl-ghpat.sh
    doctl account get
```

### Manual doctl Setup
If the auto-installer is not available, you can manually install doctl:
```bash
# Download and install doctl manually
curl -L https://github.com/digitalocean/doctl/releases/download/v1.109.0/doctl-1.109.0-linux-amd64.tar.gz | tar -xz
sudo mv doctl /usr/local/bin/

# Authenticate with DigitalOcean
doctl auth init
```

---

## üìã Manual Production Setup

### 1. System Requirements
```bash
# Install dependencies
sudo apt update
sudo apt install -y docker.io docker-compose git nodejs npm python3 python3-pip

# Start Docker
sudo systemctl start docker
sudo systemctl enable docker
```

### 2. Application Deployment
```bash
# Clone repository
git clone https://github.com/dzp5103/Spotify-echo.git
cd Spotify-echo

# Install dependencies
npm ci --only=production
pip3 install -r requirements.txt

# Configure environment
cp .env.example .env
# Edit .env with your production settings
```

### 3. Required Environment Variables
```env
# Core Configuration
NODE_ENV=production
PORT=3000
DOMAIN=yourdomain.com
FRONTEND_URL=https://yourdomain.com

# Spotify API (REQUIRED)
SPOTIFY_CLIENT_ID=your_actual_spotify_client_id
SPOTIFY_CLIENT_SECRET=your_actual_spotify_client_secret
SPOTIFY_REDIRECT_URI=https://yourdomain.com/auth/callback

# Security (Auto-generated by deployment script)
SESSION_SECRET=your_secure_session_secret
JWT_SECRET=your_secure_jwt_secret

# Optional: LLM Providers
GEMINI_API_KEY=your_gemini_api_key  # For AI chat features
OPENAI_API_KEY=your_openai_api_key  # Alternative to Gemini

# Optional: Database
MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/echotune
```

### 4. Production Services
```bash
# Using Docker (Recommended)
docker-compose up -d

# Or using PM2
npm install -g pm2
pm2 start src/index.js --name echotune-ai
pm2 save
pm2 startup
```

---

## üîí Security Configuration

### SSL/HTTPS Setup
```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx

# Get SSL certificate
sudo certbot --nginx -d yourdomain.com

# Auto-renewal
sudo crontab -e
# Add: 0 12 * * * /usr/bin/certbot renew --quiet
```

### Firewall Configuration
```bash
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw deny 3000/tcp  # Block direct access, use Nginx proxy
```

---

## üè• Health Monitoring

### Application Status
```bash
# Check application health
curl https://yourdomain.com/health

# Expected healthy response:
{
  "status": "healthy",
  "version": "1.0.0",
  "spotify_configured": true,
  "database": {"status": "healthy"},
  "features": {
    "ai_chat": true,
    "recommendations": true,
    "audio_features": true
  }
}
```

### Service Management
```bash
# Docker operations
docker-compose ps                # Check service status
docker-compose logs -f           # View logs
docker-compose restart          # Restart services
docker-compose down              # Stop services

# Monitor system resources
htop
df -h
systemctl status docker
```

---

## üìä Production Features

### ‚úÖ Fully Functional
- **Core Application**: Express server with production optimizations
- **Database Layer**: SQLite fallback with MongoDB/Supabase support
- **AI Chat System**: Mock provider with LLM integration ready
- **Spotify Integration**: OAuth authentication and API connectivity
- **Security**: Rate limiting, CORS, security headers, SSL support
- **Health Monitoring**: Comprehensive health checks and error handling

### üîÑ Environment Detection
The application automatically detects missing credentials and operates in demo mode:
- **Production Mode**: With Spotify credentials ‚Üí Full functionality
- **Demo Mode**: Without credentials ‚Üí Limited chat functionality

---

## üõ†Ô∏è Troubleshooting

### Common Issues

#### Application Won't Start
```bash
# Check logs
docker-compose logs app

# Verify environment
./scripts/production-readiness-check.sh

# Check port availability
sudo netstat -tulpn | grep :3000
```

#### Database Connection Issues
```bash
# Check MongoDB connection
# Ensure connection string is correct and IP is whitelisted

# SQLite fallback should work automatically
ls -la data/  # Check if SQLite files are created
```

#### SSL Certificate Issues
```bash
# Verify certificate
sudo certbot certificates

# Renew manually
sudo certbot renew

# Check Nginx configuration
sudo nginx -t
```

### Performance Optimization
```bash
# Enable Nginx caching
# Add to nginx.conf:
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# Monitor application performance
pm2 monit  # If using PM2
```

---

## üîÑ Maintenance

### Regular Tasks
```bash
# Update application
cd /opt/echotune
git pull origin main
docker-compose build --no-cache
docker-compose up -d

# Backup data
tar -czf backup-$(date +%Y%m%d).tar.gz data/

# Monitor logs
tail -f /var/log/nginx/error.log
docker-compose logs --tail=100 -f
```

### Updates and Security
```bash
# System updates
sudo apt update && sudo apt upgrade

# Docker image updates
docker-compose pull
docker-compose up -d

# Certificate renewal (automatic via cron)
sudo certbot renew --dry-run
```

---

## üìû Support and Resources

### Documentation
- [Main README](../README.md) - Complete project overview
- [Development Guide](../CODING_AGENT_GUIDE.md) - For developers
- [Database Architecture](../DATABASE_ARCHITECTURE_GUIDE.md) - Database setup

### Getting Help
- **GitHub Issues**: [Report bugs or request features](https://github.com/dzp5103/Spotify-echo/issues)
- **Production Readiness**: Run `./scripts/production-readiness-check.sh`
- **Health Check**: Visit `https://yourdomain.com/health`

### API Credentials
- [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)
- [Google AI Studio](https://aistudio.google.com/) (for Gemini)
- [OpenAI Platform](https://platform.openai.com/) (for ChatGPT)

---

## üéâ Success Indicators

Your EchoTune AI deployment is successful when:

1. ‚úÖ Health check returns "healthy" status
2. ‚úÖ Chat interface is accessible and responsive
3. ‚úÖ Spotify OAuth flow works (if configured)
4. ‚úÖ SSL certificate is valid
5. ‚úÖ No critical errors in logs
6. ‚úÖ Application serves responses under 500ms

**Congratulations! Your EchoTune AI instance is production-ready!** üéµ
