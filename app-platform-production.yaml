name: echotune-ai-production
region: nyc1

services:
- name: web
  source_dir: /
  github:
    repo: dzp5103/Spotify-echo
    branch: main
  run_command: npm start
  environment_slug: node-js
  instance_count: 1
  instance_size_slug: basic-xxs
  http_port: 3000
  health_check:
    http_path: /health
    initial_delay_seconds: 60
    period_seconds: 30
    timeout_seconds: 10
    success_threshold: 1
    failure_threshold: 3
  envs:
  - key: NODE_ENV
    value: "production"
  - key: PORT  
    value: "3000"
  - key: DOMAIN
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: FRONTEND_URL
    scope: RUN_AND_BUILD_TIME 
    type: SECRET
  - key: SPOTIFY_CLIENT_ID
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: SPOTIFY_CLIENT_SECRET
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: SPOTIFY_REDIRECT_URI
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: MONGODB_URI
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: SESSION_SECRET
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: JWT_SECRET
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: GEMINI_API_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: OPENAI_API_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
  - key: DEFAULT_LLM_PROVIDER
    value: "mock"
  - key: DATABASE_TYPE
    value: "mongodb"
  - key: DEMO_MODE
    value: "false"
  - key: ENABLE_HTTPS
    value: "true"
  - key: TRUST_PROXY
    value: "true"
  - key: HEALTH_CHECK_ENABLED
    value: "true"
  - key: CACHE_ENABLED
    value: "true"
  - key: COMPRESSION
    value: "true"
  - key: RATE_LIMIT_ENABLED
    value: "true"
  - key: LOG_LEVEL
    value: "info"
  - key: FEATURE_CHAT
    value: "true"
  - key: FEATURE_RECOMMENDATIONS
    value: "true"
  - key: FEATURE_PLAYLISTS
    value: "true"
  - key: FEATURE_ANALYTICS
    value: "true"

alerts:
- rule: CPU_UTILIZATION
  value: 80
- rule: MEM_UTILIZATION
  value: 85